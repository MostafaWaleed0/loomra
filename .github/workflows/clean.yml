name: ðŸ§¹ Cleanup Old Artifacts

on:
  workflow_dispatch:
    inputs:
      days:
        description: 'Delete artifacts older than (days)'
        required: true
        default: '7'
        type: string
  schedule:
    # Run weekly on Sunday at 2 AM UTC
    - cron: '0 2 * * 0'

permissions:
  actions: write
  contents: read

jobs:
  cleanup:
    name: ðŸ—‘ï¸ Delete Old Artifacts
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ðŸ“¥ Checkout Code
        uses: actions/checkout@v4

      - name: ðŸ§¹ Delete Old Artifacts
        uses: c-hive/gha-remove-artifacts@v1
        with:
          age: '${{ github.event.inputs.days || 7 }} days'
          skip-recent: 3
          skip-tags: true

      - name: ðŸ“Š Cleanup Summary
        run: |
          echo "### ðŸ§¹ Artifact Cleanup Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Deleted artifacts older than ${{ github.event.inputs.days || 7 }} days" >> $GITHUB_STEP_SUMMARY
          echo "Kept the 3 most recent artifacts" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ’¡ **Tip:** Check your storage usage at:" >> $GITHUB_STEP_SUMMARY
          echo "https://github.com/${{ github.repository }}/settings/actions" >> $GITHUB_STEP_SUMMARY
